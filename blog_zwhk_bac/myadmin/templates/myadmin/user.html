<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        {% include "myadmin/inc/header.html" %}
    </head>
    <body>
        {% include "myadmin/inc/nav.html" %}

        <div class="container">
            <div class="page-header">
                <h2>用户管理 
                    <small class="pull-right">
                        <a href="{% url 'user_add' %}" class="btn btn-primary" href=""><span class="glyphicon glyphicon-plus"></span> 添加</a>
                    </small>
                </h2>
            </div>
            <div class="table-responsive">
              <table class="table">
                  <thead>
                      <tr>
                          <th>ID</th>
                          <th>昵称</th>
                          <th>登录账号</th>
                          <th>邮箱</th>
                          <th>简介</th>
                          <th>管理功能</th>
                      </tr>
                  </thead>
                  <tbody>
                  {% for this_user in users %}
                      <tr>
                          <td>{{ this_user.id }}</td>
                          <td>{{ this_user.nickname }}</td>
                          <td>{{ this_user.username }}</td>
                          <td>{{ this_user.email }}</td>
                          <td>{{ this_user.desc }}</td>
                          <td>
                          {% if this_user.username = user.username %}
                              <a href="{% url 'user_edit' this_user.id %}" class="btn btn-primary btn-xs">编辑</a>
                              <a class="btn btn-danger btn-xs" disabled>删除</a>
                          {% elif user.id = 1 %}
                              <a href="{% url 'user_edit' this_user.id %}" class="btn btn-primary btn-xs">编辑</a>
                              <a class="btn btn-danger btn-xs" onclick="del_user('{{ this_user.id }}')">删除</a>
                          {% else %}
                              <a class="btn btn-primary btn-xs" disabled>编辑</a>
                              <a class="btn btn-danger btn-xs" disabled>删除</a>
                          {% endif %}
                          </td>
                      </tr>
                  {% endfor %}
                  </tbody>
              </table>
            </div>            
        </div>
    </body>
</html>
<script language="javascript" type="text/javascript">
    function del_user(uid){
        $.ajax({
            type:"POST",
            url:"/admin/usercontrol/delete",
            data:{"uid":uid},
            dataType:'json',
            beforeSend:function(xhr){
                xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken'));
            },
            success:function(data,textStatus){
                var errors = data["errors"];
                if(errors.length==0){
                     location.replace("/admin/users/");
                }
                else{
                    alert(errors);
                }
            },
            error:function(XMLHttpRequest, textStatus, errorThrown){
                alert(XMLHttpRequest.responseText);
            }
        })
        return false;
    }
</script>